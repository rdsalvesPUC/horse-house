<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRUD Perfil Master</title>
  <link rel="stylesheet" href="/styles/output.css" />
  <script defer src="/scripts/cadastro_proprietario.js"></script>
</head>
<body class="bg-primary">
  <header class="w-full flex items-center p-2">
    <img src="/assets/images/logo-h-whitebg.svg">
  </header>

  <div class="max-w-4xl mx-auto bg-tertiary p-6 rounded-lg shadow-lg">
    <h2 id="titulo-cadastro" class="text-3xl font-semibold text-gray-800 mb-6 text-center">Crud Master</h2>
    <form id="form-cadastro" class="space-y-4">
      
      <div class="text-left">
        <label for="nome" class="block font-medium">Nome:</label><span class="text-error"> *</span>
        <input type="text" id="nome" name="nome" class="text-sm text-gray-700 w-full p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none" />
        <p id="nome-erro" class="text-error text-sm mt-1 hidden">O Nome é obrigatório.</p>
      </div>
      
      <div class="text-left">
        <label for="sobrenome" class="block font-medium">Sobrenome</label><span class="text-error"> *</span>
        <input type="text" id="sobrenome" name="sobrenome" class="text-sm text-gray-700 w-full p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none" />
        <p id="sobrenome-erro" class="text-error text-sm mt-1 hidden">O Sobrenome é obrigatório.</p>
      </div>
      
      <div class="mt-2">
        <label for="tipo-acao" class="block font-medium">Ações Disponíveis:</label>
        <select id="tipo-acao" name="tipo-acao" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none">
          <option value="">Selecione</option>
          <option value="Create">Create</option>
        </select>
        <p id="tipo-acao-erro" class="text-error text-sm mt-1 hidden">Ação é obrigatória.</p>
      </div>

      <div id="tipo-usuario-container" class="hidden mt-2">
        <label for="tipo-usuario" class="block font-medium">Tipo de Usuário:</label><span class="text-error"> *</span>
        <select id="tipo-usuario" name="tipo-usuario" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none">
          <option value="">Selecione</option>
          <option value="Gerente">Gerente</option>
          <option value="Treinador">Treinador</option>
          <option value="Vet">Veterinário</option>
          <option value="Tratador">Tratador</option>
        </select>
        <p id="tipo-usuario-erro" class="text-error text-sm mt-1 hidden">Selecione um tipo de usuário.</p>
      </div>

      <div id="id-haras" class="hidden mt-2">
        <label for="select-haras" class="block font-medium">Selecione o Haras:</label><span class="text-error"> *</span>
        <select id="select-haras" name="select-haras" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none">
          <option value="">Selecione</option>
        </select>
        <p id="select-haras-erro" class="text-error text-sm mt-1 hidden">Selecione um Haras.</p>
      </div>

      <!-- Campos específicos -->
      <div id="campos-gerente" class="hidden mt-2 space-y-2">
        <label class="block font-medium">Campos para Gerente:</label>
        <input type="text" id="email" name="email" placeholder="Email" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="email-erro" class="text-error text-sm mt-1 hidden">O Email é obrigatório.</p>
        <span id="email-invalido" class="text-error text-sm hidden">Insira um e-mail válido.</span>
        
        <input type="text" id="cpf" name="cpf" placeholder="CPF" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="cpf-erro" class="text-error text-sm mt-1 hidden">O CPF é obrigatório.</p>
        <span id="cpf-invalido" class="text-error text-sm hidden">CPF inválido! Digite um CPF válido.</span>
        
        <input type="text" id="telefone" name="telefone" placeholder="Telefone" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="telefone-erro" class="text-error text-sm mt-1 hidden">O Telefone é obrigatório.</p>
        <span id="telefone-invalido" class="text-error text-sm hidden">Insira um telefone válido (Deve ter entre 10 e 11 dígitos e não pode conter letras).</span>
        
        <input type="date" id="data-nascimento" name="data-nascimento" placeholder="Data de Nascimento" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="data-nascimento-erro" class="text-error text-sm mt-1 hidden">A Data de Nascimento é obrigatória.</p>
        <p id="data-nascimento-invalida" class="text-error text-sm mt-1 hidden">Insira uma data de nascimento válida.</p>
        
        <input type="text" id="senha" name="senha" placeholder="Senha" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="senha-erro" class="text-error text-sm mt-1 hidden">A Senha é obrigatória.</p>

      </div>

      <div id="campos-treinador" class="hidden mt-2 space-y-2">
        <label class="block font-medium">Campos para Treinador:</label><span class="text-error"> *</span>
        <input type="text" id="email" name="email" placeholder="Email" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="email-erro" class="text-error text-sm mt-1 hidden">O Email é obrigatório.</p>
        <span id="email-invalido" class="text-error text-sm hidden">Insira um e-mail válido.</span>
      
        <input type="text" id="cpf-treinador" name="cpf-treinador" placeholder="CPF" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="cpf-erro" class="text-error text-sm mt-1 hidden">O CPF é obrigatório.</p>
        <span id="cpf-invalido" class="text-error text-sm hidden">CPF inválido! Digite um CPF válido.</span>

        <input type="text" id="telefone" name="telefone-treinador" placeholder="Telefone" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="telefone-erro" class="text-error text-sm mt-1 hidden">O Telefone é obrigatório.</p>
        <span id="telefone-invalido" class="text-error text-sm hidden">Insira um telefone válido (Deve ter entre 10 e 11 dígitos e não pode conter letras).</span>

        <input type="date" id="data-nascimento" name="data-nascimento-treinador" placeholder="Data de Nascimento" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="data-nascimento-erro" class="text-error text-sm mt-1 hidden">A Data de Nascimento é obrigatória.</p>
        <p id="data-nascimento-invalida" class="text-error text-sm mt-1 hidden">Insira uma data de nascimento válida.</p>

        <input type="text" id="senha" name="senha-treinador" placeholder="Senha" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="senha-erro" class="text-error text-sm mt-1 hidden">A Senha é obrigatória.</p>
      </div>

      <div id="campos-veterianario" class="hidden mt-2 space-y-2">
        <label class="block font-medium">Campos para Veterinário:</label><span class="text-error"> *</span>
        <input type="text" id="CRMV" name="CRMV" placeholder="CRMV" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />

        <input type="text" id="email" name="email" placeholder="Email" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="email-erro" class="text-error text-sm mt-1 hidden">O Email é obrigatório.</p>
        <span id="email-invalido" class="text-error text-sm hidden">Insira um e-mail válido.</span>
      
        <input type="text" id="cpf-treinador" name="cpf-treinador" placeholder="CPF" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="cpf-erro" class="text-error text-sm mt-1 hidden">O CPF é obrigatório.</p>
        <span id="cpf-invalido" class="text-error text-sm hidden">CPF inválido! Digite um CPF válido.</span>

        <input type="text" id="telefone" name="telefone-treinador" placeholder="Telefone" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="telefone-erro" class="text-error text-sm mt-1 hidden">O Telefone é obrigatório.</p>
        <span id="telefone-invalido" class="text-error text-sm hidden">Insira um telefone válido (Deve ter entre 10 e 11 dígitos e não pode conter letras).</span>

        <input type="date" id="data-nascimento" name="data-nascimento-treinador" placeholder="Data de Nascimento" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="data-nascimento-erro" class="text-error text-sm mt-1 hidden">A Data de Nascimento é obrigatória.</p>
        <p id="data-nascimento-invalida" class="text-error text-sm mt-1 hidden">Insira uma data de nascimento válida.</p>

        <input type="text" id="senha" name="senha-treinador" placeholder="Senha" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="senha-erro" class="text-error text-sm mt-1 hidden">A Senha é obrigatória.</p>
      </div>

      <div id="campos-tratador" class="hidden mt-2 space-y-2">
        <label class="block font-medium">Campos para Tratador:</label><span class="text-error"> *</span>
        <input type="text" id="email" name="email" placeholder="Email" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="email-erro" class="text-error text-sm mt-1 hidden">O Email é obrigatório.</p>
        <span id="email-invalido" class="text-error text-sm hidden">Insira um e-mail válido.</span>
      
        <input type="text" id="cpf-treinador" name="cpf-treinador" placeholder="CPF" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="cpf-erro" class="text-error text-sm mt-1 hidden">O CPF é obrigatório.</p>
        <span id="cpf-invalido" class="text-error text-sm hidden">CPF inválido! Digite um CPF válido.</span>

        <input type="text" id="telefone" name="telefone-treinador" placeholder="Telefone" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="telefone-erro" class="text-error text-sm mt-1 hidden">O Telefone é obrigatório.</p>
        <span id="telefone-invalido" class="text-error text-sm hidden">Insira um telefone válido (Deve ter entre 10 e 11 dígitos e não pode conter letras).</span>

        <input type="date" id="data-nascimento" name="data-nascimento-treinador" placeholder="Data de Nascimento" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="data-nascimento-erro" class="text-error text-sm mt-1 hidden">A Data de Nascimento é obrigatória.</p>
        <p id="data-nascimento-invalida" class="text-error text-sm mt-1 hidden">Insira uma data de nascimento válida.</p>

        <input type="text" id="senha" name="senha-treinador" placeholder="Senha" class="w-full max-w-xs p-3 border rounded-md focus:ring-2 focus:ring-secondary outline-none mb-4" />
        <p id="senha-erro" class="text-error text-sm mt-1 hidden">A Senha é obrigatória.</p>
      </div>

      <button id="botao-cadastrar" type="submit" class="w-full py-3 text-white bg-secondary rounded-md transition duration-300 ease-in-out hover:bg-primary mt-3">Cadastrar</button>
    </form>
  </div>

  <script>
    const tipoAcao = document.getElementById("tipo-acao");
    const tipoUsuario = document.getElementById("tipo-usuario");
    const tipoUsuarioContainer = document.getElementById("tipo-usuario-container");
    const selectHaras = document.getElementById("select-haras");
    const idHaras = document.getElementById("id-haras");
  
    const campos = {
      Gerente: document.getElementById("campos-gerente"),
      Treinador: document.getElementById("campos-treinador"),
      Vet: document.getElementById("campos-veterinario"),
      Tratador: document.getElementById("campos-tratador"),
    };
  
    function esconderTodosCampos() {
      Object.values(campos).forEach((campo) => campo.classList.add("hidden"));
    }
  
    // Função para buscar os haras do proprietário e popular o select
    async function carregarHaras() {
      try {
        const response = await fetch("http://localhost:3000/api/getAllHaras", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${localStorage.getItem('token')}`, // token JWT
            "Content-Type": "application/json"
          }
        });
  
        if (!response.ok) {
          throw new Error("Erro ao buscar haras");
        }
  
        const haras = await response.json();
  
        // Limpa o select atual
        selectHaras.innerHTML = '<option value="">Selecione</option>';
  
        // Popula o select com os haras recebidos
        haras.forEach(harasItem => {
          const option = document.createElement("option");
          option.value = harasItem.id;
          option.textContent = harasItem.Nome;
          selectHaras.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar haras:", error);
      }
    }
  
    tipoAcao.addEventListener("change", function () {
      if (this.value === "Create") {
        tipoUsuarioContainer.classList.remove("hidden");
        idHaras.classList.remove("hidden");
        carregarHaras(); // <-- aqui chamamos a função
      } else {
        tipoUsuarioContainer.classList.add("hidden");
        tipoUsuario.value = "";
        esconderTodosCampos();
      }
    });
  
    tipoUsuario.addEventListener("change", function () {
      esconderTodosCampos();
      const tipoSelecionado = this.value;
      if (campos[tipoSelecionado]) {
        campos[tipoSelecionado].classList.remove("hidden");
      }
    });
  
    document.getElementById("botao-cadastrar").addEventListener("click", function (event) {
      event.preventDefault();
  
      const nome = document.getElementById("nome").value;
      const sobrenome = document.getElementById("sobrenome").value;
      const tipoUsuarioSelecionado = document.getElementById("tipo-usuario").value;
  
      if (tipoUsuarioSelecionado === "Gerente") {
        const email = document.querySelector('#campos-gerente input[placeholder="Email"]').value;
        const cpf = document.querySelector('#campos-gerente input[placeholder="CPF"]').value;
        const telefone = document.querySelector('#campos-gerente input[placeholder="Telefone"]').value;
        const dataNascimento = document.querySelector('#campos-gerente input[placeholder="Data de Nascimento"]').value;
        const senha = document.querySelector('#campos-gerente input[placeholder="Senha"]').value;
        const idHarasSelecionado = document.getElementById("select-haras").value;
  
        const dados = {
          nome,
          sobrenome,
          email,
          cpf,
          telefone,
          dataNascimento,
          senha,
          haras_id: idHarasSelecionado
        };
  
        fetch("http://localhost:3000/api/criarGerente", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem('token')}`
          },
          body: JSON.stringify(dados)
        })
        .then(response => response.json())
        .then(data => {
          console.log("Resposta do servidor:", data);
          alert("Gerente cadastrado com sucesso!");
        })
        .catch(error => {
          console.error("Erro ao cadastrar gerente:", error);
        });
      }
  
      if (tipoUsuarioSelecionado === "Treinador") {
        const email = document.querySelector('#campos-treinador input[placeholder="Email"]').value;
        const cpf = document.querySelector('#campos-treinador input[placeholder="CPF"]').value;
        const telefone = document.querySelector('#campos-treinador input[placeholder="Telefone"]').value;
        const dataNascimento = document.querySelector('#campos-treinador input[placeholder="Data de Nascimento"]').value;
        const senha = document.querySelector('#campos-treinador input[placeholder="Senha"]').value;
  
        const dados = {
          nome,
          sobrenome,
          email,
          cpf,
          telefone,
          dataNascimento,
          senha
        };
  
        fetch("http://localhost:3000/api/criarTreinador", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem('token')}`
          },
          body: JSON.stringify(dados)
        })
        .then(response => response.json())
        .then(data => {
          console.log("Resposta do servidor:", data);
          alert("Treinador cadastrado com sucesso!");
        })
        .catch(error => {
          console.error("Erro ao cadastrar treinador:", error);
        });
      }
    });
  </script>  
</body>
</html>